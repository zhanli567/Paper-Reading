# A Survey of Intrusion Detection for In-Vehicle Networks

**车载网络入侵检测综述**

[原文PDF](./A Survey of Intrusion Detection for In-Vehicle Networks.pdf)

    首先介绍了IVN环境，阐述IVN入侵检测系统的约束条件和特点。接着对已提出的IVN IDS设计进行了综述，重点指出了相应的缺陷。考虑并全面比较了各种优化目标。最后描述了发展趋势、开放性问题和新兴的研究方向。

**关键词：**控制器局域网CAN；网络安全；车载网络IVN；入侵检测系统IDS；信息熵；机器学习

## 一、介绍

    针对各类对车载网络恶意攻击提出的对策：(1)通过加密和认证技术确保IVN信息帧的保密性和完整性。(2)将潜在的攻击接口和IVN分离（防火墙策略）。(3)为IVN开发入侵检测系统。对策1受成本、计算能力、带宽和存储资源的限制；对策2考虑到汽车的长生命周期和IVN多个攻击入口，通过防火墙完全隔离是不切实际的。

    IVN IDS旨在提供：(1)保证时间的前提下识别异常入侵的能力；(2)为入侵防御系统IPS提供准确信息；(3)防止IVN攻击进一步损害系统。

## 二、预备知识

#### A. IVNs的背景

![image-20241102100805278](https://s2.loli.net/2024/11/02/NrtHuhKP1zl3vJS.png)

    **异构分布式实时系统环境：**异构性不仅体现在ECU节点处理器上还体现在内部网络上。平衡成本和性能的方法是设计车载网络入侵检测系统的关键问题之一。

    **大量的外部接口：**![image-20241102111304822](https://s2.loli.net/2024/11/02/M6HpyXtSdOjboAF.png)

    **多功能安全关键等级系统：**ISO26262标准将汽车电子系统分为四个汽车安全完整性等级A、B、C和D。

    **缺乏网络安全设计**

#### B. 对IVNs的攻击

![image-20241102115640863](https://s2.loli.net/2024/11/02/qeVa1w64jFZXOhu.png)

#### C. 车载网络入侵系统的约束、挑战及特点

1)约束条件

    **硬件约束**、**成本约束**、**检测精度和响应时间**、**标准化建设**

2)特点

    **Domain-aware：**领域感知，不同功能领域划分为若干部分，相互独立通过车内网关相连。

![image-20241102121849573](https://s2.loli.net/2024/11/02/xNwj95MhKCHRFG1.png)

    **Context-aware：**情境感知，将感知层数据和模式相结合，并将该层与安全监测系统集成起来有效降低误判的概率。

![image-20241102122027386](https://s2.loli.net/2024/11/02/InvLpUtG7Oc8XE1.png)

    总结，基于攻击接入源、车载网络漏洞、攻击威胁、可提取特征参数以及IDS应对措施之间的关联性绘制如下图所示。

![image-20241102122149701](https://s2.loli.net/2024/11/02/zUwDYB6n3Eb7Iks.png)

## 三、车载网络先进的入侵检测技术

#### A. 基于指纹的方法（总线层面）

    不同的ECU具有独特的硬件指纹信息，研究人员以各种方式提取ECU的指纹信息。在获取到网络指纹特征之后下一步将是一个分类问题。

#### B. 基于参数监测的方法（消息层面）

1）基于频率的技术

![image-20241102123844908](https://s2.loli.net/2024/11/02/P5wZi1GgNbtUXlK.png)

    车载网络传输的消息帧通常有固定的周期。例如，可以检测CAN消息的传输间隔，并将其与既定的基线进行比较，此类检测方法有可能具备较高的准确性和较低的误报率，但仅适用于周期性流量。

2）远程帧

![image-20241102123925715](https://s2.loli.net/2024/11/02/rytfL97xukz5Cde.png)

    当CAN总线上的一个节点接收到一个远程帧时，它需要向发送方回复一条消息。回复帧的偏移率能够反映出可疑活动。

    下图展示了如何独立于车内网络（IVN）数据序列来处理时间 / 频率特征。如图所示，车内网络入侵检测系统技术可分为对数据流和序列的观测。针对来自车内网络数据流层面的攻击，基于参数检测的入侵检测方法具有良好的检测精度且性能开销较低。

![image-20241102124334514](https://s2.loli.net/2024/11/02/r5yoBXJ2zMDTpLs.png)

#### C. 基于信息论的车载网络入侵检测系统（数据流层面）

    在车载网络环境中，采用基于信息论的度量方法是进行无监督异常检测设计的另一种途径。每个ECU内部通信通常是有序的，因此系统信息熵应该相对稳定。大量恶意信息注入到正常通信中会影响网络稳定性，信息熵能够反映这种异常情况。

    该方法在针对修改CAN数据字段内容的攻击中是无效的。为提高基于信息熵检测的准确性可以结合前文提到的领域感知和上下文感知来优化设计。

#### D. 基于机器学习的车载网络入侵检测系统（功能层面）

1）基于分类的技术：结合分类算法设计IDS，学习网络流量中的正常行为，任何偏离该正常行为的情况将识别为CAN总线的异常行为。如下图所示，该方案包括两个阶段，离线训练和在线检测。训练阶段选择并标注训练数据集很重要。

![image-20241102130342017](https://s2.loli.net/2024/11/02/r4KaYplc352ytUH.png)

2）深度学习技术：基于神经网络对下一个数据包数据的预测被用于入侵检测，因此不需要了解特定协议的知识。下图展示了应用于IVN IDS的神经网络的三层结构。其中，与普通神经网络模型的差异主要体现在输入层和输出层，输入特征可以是CAN数据字段的比特位，也可以是从 CAN 总线物理层提取的信号特征。输出层输出正常和异常结果。

![image-20241102130545376](https://s2.loli.net/2024/11/02/FCPqgJa1BG2T3Ky.png)

3）序列技术：ECU发送消息的顺序可用于异常检测。来自ECU的CAN消息应被视为具有特定顺序。它们将根据消息的优先级依次发送，任何偏离此顺序的情况都可被标记出来。

#### E. 其他方法

    **领域感知型IVN IDS**、**情境感知型IVN IDS**

#### F. 针对其他IVN的IDS设计

    CAN-FD、FlexRay、LIN、汽车以太网

## 四、车载网络入侵检测评估与比较

#### A. 以往研究工作中使用的数据集和工具

    实验数据集通常分为两部分：正常运行条件下的数据以及在各种攻击模式下带有攻击信号的数据。

#### B. 车载网络入侵检测的比较

![image-20241102132550356](https://s2.loli.net/2024/11/02/geYJNnlGT1W9XZB.png)

![image-20241102133611428](https://s2.loli.net/2024/11/02/HDPCxlXsFqJRopn.png)

1）不同IVN IDS可抵御来自IVN各个方面的多种网络攻击。

2）基于机器学习的入侵检测方法在应对未知的攻击效果良好，但需要大量计算和存储资源，不适合汽车网络环境。

3）上表显示，目前大多数研究方法误报率都较低且具有较高检测准确率。但用一种方法来应对所有现存的攻击是很困难的，可以利用分布在IVN不同层面的特征来优化未来IVN IDS的设计，不局限于IVN某一层面的特征。

#### C. 入侵防御系统

    IDS在安全防护方面作用有限，作为安全防御的第一道防线，通常是入侵防御系统IPS的一部分。

## 五、趋势与展望

#### A. 趋势

1）自动驾驶车辆的发展会加速车载网络的发展，制定网络标准之初考虑安全机制，为未来的网络环境提供保障，同时要考虑IDS的功能。

2）边缘计算技术的发展将解决IDS技术实施中计算和存储资源有限的瓶颈问题。

3）汽车制造商对汽车电子系统的功能安全拥有一套完整的设计、测试和验证开发的流程。未来IVN系统的信息安全需要测试和验证平台的支持。

#### B. 开放问题

1）最为紧迫的问题之一是提高其准确性和响应时间。如何区分IVN中恶意攻击和异常情况亦是具有挑战性的研究。

2）汽车领域一个重要问题是将已有的功能安全流程和方法应用于安全工程。车辆的功能安全和IVN的安全属于不同的领域。

3）当前汽车电子元件由供应链的不同环节分别提供。所有的安全漏洞都出现在不同开发者所提供代码的边界处。应建立统一的标准协调供应链。

4）在入侵IVN过程中，不同的步骤必然影响不同的网络层，进而产生可用于IDS观测的特征。如何利用这些跨越IVN各层的特征来提高IDS的性能是一个重要研究方向。

5）机器学习算法在匿名入侵检测方面有优势。但面临两个挑战一是如何在计算资源有限的IVN系统中部署，另一个是如何获取可有效用于训练的数据集。

# The Hybrid Similar Neiglborhood Robust Factorization Machine Model for Can Bus Intrusion Detection in the In-Vehicle Network

[原文PDF](./The Hybrid Similar Neighborhood Robust Factorization Machine Model for Can Bus Intrusion Detection in the In-Vehicle Network.pdf)

    最近基于机器学习的入侵检测方法仅使用消息数据字段中的信息，没有考虑相邻信息做出的贡献，此外以前模型把CAN消息的数据域消息视为单独的特征，没有考虑每个特征的独特权重及特征间的二阶交互信息 -> 本文提出混合相似领域鲁棒因子分解机模型（HSNRFM） -> 利用相似数据口径和因式分解机模型解决上述问题。

**关键词：**入侵检测模型；车载网络；控制器局域网总线；现代汽车安全；因式分解机

## 一、引言

    主要贡献：

（1）使用全连接网络增强原始数据的鲁棒性，使用相似邻居的数据域增强目标CAN总线消息的特征表示。

（2）使用因式分解机模型，可以考虑二阶交互特征信息预测异常结果的最终概率。

（3）在实车数据集上对比实验结果。

## 二、相关工作

    介绍了今年来研究人员提出的针对CAN总线的入侵检测模型。

## 三、方法

![image-20241111141022093](https://s2.loli.net/2024/11/11/6h82NmjILoVviQH.png)

**A 提高数据鲁棒性并扩展邻域功能**

（1）将原始CAN总线报文数据域部分由十六进制转成二进制。Data2 = BFC(Data) ，BFC表示二进制格式转换，Data2为转换后的二进制编码。

（2）增强原始数据域中的鲁棒性，使用全连接网络对data2进行预处理，RD = f（WT Data2 + b），W为全连接网络的权重参数，b为偏置参数，f为激活函数，RD代表Robust Data。

（3）为在模型决策过程中纳入相似邻域信息的贡献，HSNRFM模型计算消息之间的相似度，相似度计算方程使用余弦相似度，Sim = cosine - similarity(Data2)，cosine - similarity是sklearn库中的余弦相似度方程，Sim是消息之间相似度矩阵，每行存储此消息与其他消息之间的相似度信息。

（4）HSNRFM模型把目标消息的数据信息和与目标消息最相似的邻近消息的数据信息组合成最终的输入特征。这样可以最大化消息特征的维数。RFi = RDi；RFj = RDj，j属于N(i)；FIFi = Join(RFi, RFj) = [RFi, RFj]。

**B 使用因式分解机模型生成预测**

![image-20241111142601732](https://s2.loli.net/2024/11/11/6eXpuBHMi9OxA8V.png)

    公式中第一部分是偏置，第二部分是线性回归的预测值，第三部分是二阶交互信息的预测值，二阶交互信息指两个特征协同作用对预测值产生影响，理论上也有三阶四阶等高阶交互信息。

![image-20241111143242508](https://s2.loli.net/2024/11/11/iCHJ9mF6aSDNBef.png)

    上述算法为HSNRFM算法的伪代码。

## 四、实验与讨论

**A 数据集和预处理操作**

    实验部分使用文献[45] H. Lee, S. H. Jeong, and H. K. Kim, “OTIDS: A novel intrusion detection system for in-vehicle network by using remote frame,” in Proc. 15th Annu. Conf. Privacy, Secur. Trust (PST), Aug. 2017, pp. 57–5709.中的数据集**OTIDS**。

    将CAN ID为0545和0316的样本作为实验数据集分为Data A和Data B。使用四个指标评估：AUC（区域下ROC曲线）、AUPR（区域下精确值 - 召回曲线）、精确度和召回。

**B 超参数实验**

（1）全连接网络维数：

![image-20241111143813913](https://s2.loli.net/2024/11/11/FyWmjUq3COxTIGM.png)

![image-20241111143827102](https://s2.loli.net/2024/11/11/31rsujLJa9EdpR6.png)

    实验表明给定数据集全连接网络的适当维数可以增强输入数据的鲁棒性，提高模型性能。

（2）超参数α的值：

![image-20241111144017167](https://s2.loli.net/2024/11/11/FRUyf24ZqVut9KA.png)

    实验表明一定比例的特征二阶关联信息可以提高模型在AUC和AUPR度量下的性能，却降低了模型在Precent和Recall度量下的性能，原因是二阶交互信息并不能满足所有的评价度量，不同评价度量各有侧重点和局限性，故需针对不同场景选择不同比例的二阶交互信息。

**C 基准比较**

    将HSNRFM模型与四种经典入侵检测算法在Data A和Data B两个数据集上比较。四种算法分别为：GBDT、XGBoost、RF和SVC。

![image-20241111144400202](https://s2.loli.net/2024/11/11/fokGSr267c5QvUW.png)

    对比实验表明HSNRFM模型性能领先其余四个基准模型，验证其有效性。

![image-20241111144529224](https://s2.loli.net/2024/11/11/YkAOlRCejsaqg5t.png)

    上图展示了特定实验的损失值。

## 五、结论

    本工作中，利用全连接网络增强原始数据的鲁棒性，并创新性使用相似邻域的数据来增强目标CAN总线消息的特征表示。此外使用因式分解机模型，该模型使用了二阶交互特征信息，预测异常结果最终概率，一定程度上减少了丢失的特征信息。在实车数据集上进行实验后表明文中的HSNRFM模型在入侵检测方面由出色的能力。但仍存在局限性如兼容高阶特征交互信息。

# Deep Learning Based Anomaly Detection for Connected Autonomous Vehicles Using Spatiotemporal Information

[原文PDF](./Deep Learning Based Anomaly Detection for Connected Autonomous Vehicles Using Spatiotemporal Information.pdf)
	本文提出了一种基于预测的IDS框架，利用消息内容的时间相关性检测CAN总线上的异常和攻击。引入了两个预测模块，第一个是分别预测每个CAN ID的时间序列数据的LSTM，第二个是使用多个CAN ID相关数据预测消息的ConvLSTM。攻击由高斯朴素贝叶斯分类器进行分类。提出的IDS与其他分类器（OCSVM、隔离森林和自动编码器）及现有三部作品（ReducedInception-ResNet、NeuroCAN和CANLite）评估后证明其更准确。
**关键词：**车载安全、CAN、异常检测、IDS、LSTM、ConvLSTM、时空相关性

## 一、引言

    本文提出一种基于机器学习方法的CAN总线网络异常驱动IDS框架。对CAN总线的攻击导致消息内容的时间序列数据显示为分组异常。它们只能在作为一批结果的一部分进行检查时才能被识别。为解决这问题，提出了一种时间序列预测网络，根据消息随时间的序列来确定CAN网络的正常模型。过去的CAN消息被用作预测当前预期消息的输入。

## 二、相关工作

    本文的贡献如下：
（1）提出的异常检测方法利用CAN总线上消息的正常配置文件，根据历史消息预测即将到来的消息。
（2）设计了两种预测模型，一种基于LSTM，另一种基于ConvLSTM。LSTM模块单独预测每个ECU产生的下一条消息，而不考虑其他消息；ConvLSTM模块利用具有各种CAN ID的消息的时空相关性来考虑不同ECU的相互依赖性。
（3）提出的框架利用高斯朴素贝叶斯分类器将MAE分类为预测误差度量，可以有效地检测可能无法通过阈值设置方法检测到的细微异常。
（4）提出的方法直接处理有效载荷的位表示。这使得在不同制造商和车辆之间的泛化变得更加容易。
（5）提出的IDS可以检测已知（如DoS、模糊和欺骗）和未知攻击。

## 三、CAN总线异常检测框架

![image-20241112152607801](https://s2.loli.net/2024/11/12/xSL1lcrm4viBMoz.png)

    上图展示本文所提出的IDS框架，由三个模块组成：预测网络、预测误差计算器和高斯朴素贝叶斯GNB分类器。IDS的输入是所有的CAN ID消息，输出是样本属于它的概率最高的类标签（攻击或正常）。

**A 时间序列预测网络**

    输入数据：从CAN消息中选择特征，包括数据长度控制DLC和8字节的有效载荷数据，DLC小于8的帧用0填充。因每个特征尺度不同，使用min-max技术对数据集进行归一化操作，公式Xnormalized = (X - Xmin)/(Xmax - Xmin)，归一化后，所有特征在0-1之间有相似的取值，如下图所示。

![image-20241112153517653](https://s2.loli.net/2024/11/12/cL5qdB7Z3rxTNte.png)

    接着将数据馈送到基于RNN的网络中处理。预测模块是一个基于RNN的网络。RNN单元的输出依赖于序列中的前面元素。每个门训练期间学习的权重随时间推移而共享，并决定保留和忘记多少信息。

**B 预测误差计算器**

    前提：模型被训练在CAN ID的正常行为上。将上一步的数据作为输入，在指示的时间t预测每个CAN消息的预期状态，为测量预测值和真是观测值的不相似性，在预测误差计算器中使用了平均绝对误差MAE。

![image-20241112154203656](https://s2.loli.net/2024/11/12/ABgkhGiJ3OTswzR.png)

    预测误差表明预测网络的输出与当前CAN消息值得匹配程度。由于预测根据网络的正常配置文件进行的，对于未修改的CAN消息，预测误差接近于零，但对于被操纵的消息，预测误差相对较高。

**C GNB分类器**

![image-20241112155949004](https://s2.loli.net/2024/11/12/17LmyornjS3Vd6I.png)

    GNB分类器模块在时间t对输入消息做决定。计算数据属于正常或攻击类别的概率，并选择概率较高的类别作为报告类别。

## 四、预测模块神经网络设计

**A LSTM网络**

    LSTM是RNN的增强版，将RNN的学习策略从学习要记住什么信息切换到学习要忘记什么信息来解决RNN的消失梯度问题。一个LSTM网络分别针对每个CAN ID进行训练。单独的误差计算器和GNB分类器也处理每个基于LSTM的检测结果。CAN消息先根据其ID分类，然后重定向到相应的IDS。

**B 基于ConvLSTM的网络**

    ConvLSTM纳入了空间相关性，更擅长用更少的模型参数从输入数据中提取时空相关性。它根据先前的状态及其局部邻居的输入来确定未来状态。与LSTM的比较如下图。

![image-20241112181712374](https://s2.loli.net/2024/11/12/qEnxhd7RiSzTCOk.png)

![image-20241112182008204](https://s2.loli.net/2024/11/12/3vNjlRELHkKf1ce.png)

**C 基于LSTM和基于ConvLSTM的预测模块的比较**

    如果针对所有CAN ID的输入训练部署一个ConvLSTM模型，训练和维护单个模型所消耗的资源较少，但由于不相干的信号干扰，如车辆速度、发动机温度等，性能较低。对于每个CAN ID的单个LSTM模型增加了IDS的内存和计算需求，但它避免了不相干的信号。一种可能的解决方案是根据它们相互依赖关系将CAN ID分成组，应用不同的基于ConvLSTM模型。基于LSTM的模型可用于不适合组的单个CAN ID。

## 五、实验评估

**A 攻击模型**

（1）DoS攻击

（2）模糊攻击

（3）欺骗攻击

**B 数据集**

    使用HCRL提供的CAN总线公开数据集汽车黑客数据集。

![image-20241112183034098](https://s2.loli.net/2024/11/12/36TgOSeauvxEFzj.png)

**C 结果**

![image-20241112184005063](https://s2.loli.net/2024/11/12/HKyV7gn4E6JMskC.png)

    图9显示减少回溯会导致IDS性能下降，因为预测模块考虑较少的历史观察来预测即将到来的消息。考虑一系列长的观察结果也会降低检测性能，因为附近的元素比那些更远的元素更有可能相关。

![image-20241112183855993](https://s2.loli.net/2024/11/12/4DIApXZBkCclVjt.png)

    图8说明更长的序列预测会导致更长的流转时间。为避免更慢的检测和性能下降，回溯值应尽可能小。

![image-20241112184246092](https://s2.loli.net/2024/11/12/dE85m6YbrT4uniK.png)

## 六、总结

    提出了两种基于异常的IDS方案检测攻击，包括LSTM-GNB IDS和ConvLSTM-GNB IDS。通过看到最后一条消息后预测接下来会出现什么消息，将其与实际观察到的消息进行比较。差异用平均绝对误差MAE计算，误差的正常性由GNB决定。在于OCSVM、隔离森林及基于LSTM的自动编码器相比，LSTM-GNB和ConvLSTM-GNB表现出更好的性能。因为它们考虑了每条消息在时间序列中的位置。

# A Model Based Method for Enabling Source Mapping and Intrusion Detection on Proprietary Can Bus

[原文PDF](./A Model Based Method for Enabling Source Mapping and Intrusion Detection on Proprietary Can Bus.pdf)

    设计了一种基于时间偏差的方法，能精确定位发送者并检测CAN总线上的入侵，以单个CAN帧为测量对象，调整测量过程使方法独立于帧的传输时间；提出了一种基于分数机制过滤原始数据的图盒算法，估计和累积时钟偏差以建立表示发射ECU的线性模型。

**关键词：**汽车安全；控制器局域网；源映射；入侵检测

## 一、引言

    主要贡献：

（1）提出一种基于模型的方法，利用时钟偏差描述信号特征和发送ECU之间的关系。

（2）从单个帧实例的信号长度而不是连续周期帧之间的时间差来计算时钟偏移。故该方法可以独立于CAN帧的到达或传输时间，方法可以应用于任何CAN帧且不用考虑其传输周期性。

（3）在对实车数据统计分析的基础上提出了一种去除异常测量的新颖box-Drap算法，新算法过滤后的数据能精准描述发送ECU的硬件特性。

（4）在一辆CAN总线原型和两辆量产车上评估方法。证明该方法可以在无任何先验知识的情况下为被监控的CAN总线上的ECU建立模型。两类车上的ECU都可以区分且可以有效检测入侵。

## 二、背景

**A CAN入门**

    汽车CAN总线；广播性质和面向消息的协议；CAN数据传输；仲裁和确认。

**B 信号时差的原因**

（1）时钟：时钟是电子设备中的固有特性，由设备驱动的电信号可以继承时钟特性的变化。相关概念，两种时钟C1、C2。时钟偏移量：C1(t) - C2(t)；时钟频率：C1'(t) = dC1(t) / C1(t)；时钟偏差：C1'(t) - C2'(t)。

（2）CAN收发器：收发器控制逻辑电平的数据如何转换为总线上传输的电表示，抖动等特性和噪声可以在信号中表达出来。

## 三、相关工作

**A 基于监督学习算法的方法**

**B 基于模型的方法**

## 四、问题的形成

    本文要解决的问题如下：（1）发送ECU识别；（2）ECU枚举：用于检测网络结构的变化。对于给定的数据流量，系统输出ECU总数以及所有提取的标识符I1,I2,...,Im和它们发送ECU之间的映射E1,E2,...,En。在没有攻击的情况下标识符和ECU之间关系应该是多对一的；（3）入侵检测：文中工作考虑的攻击为伪装攻击。

## 五、我们的方法

**A 数据收集**

    首先测量帧级信号持续时间Si，系统读取标识符Ii和测量过程中的位数ni。偏移量Oi = Si - NBT * ni，其中NBT是标称位时间。数据接着按标识符分组输入到下一阶段。

    测量不考虑整个信息，仅应用于由发射器驱动的信号部分，由于ACK场期间的电气表示不反映发射器ECU特性，故ACK场信号排除在测量之外。测量间隔从第一个上升沿开始到倒数第二个上升沿如下图所示，起点和终点设置为上升沿的0.9V。

![image-20241113141317640](https://s2.loli.net/2024/11/13/eKyF7dSVAvRNfUg.png)

    测量应用于差分信号，电磁干扰对高低电平影响几乎相同，故差分信号不受此类噪声影响，提供稳定的电信号。

**B 预处理**

    目标是在此步骤中删除异常测量值。提出了一种新颖的箱型图算法称为基于分数的边界箱线图SBB-box-plot。原始箱线图定义四个数字汇总数据，下四分位数、上四分维数、下须线、上须线。位于上、下须线之外的数据点视为异常值。在使用真实车辆和总线原型测量后发现原始的方法并不能直接使用在本文工作中。提出了SBB箱型图算法。

![image-20241113142822452](https://s2.loli.net/2024/11/13/dIqmDYGNgw5H6FC.png)

**C 时钟偏移估计**

    以帧实例单位计算clock skew。clock skew是ECU中clock相对于true clock的频率差（其偏移量的一阶导数）。考虑到clock skew是恒定的，一个帧实例长度内累积时钟偏移量随时间线性增加。累积时钟偏移量的斜率可以视为clock skew。因此clock skew可计算为一个帧实例长度内的总偏差除以该接收到帧实例的总测量长度。表示为Skewwi = Oi / Si = (Si - NBT * ni) / Si。

**D 模型生成**

    利用线性回归模型来表示每个ECU，因clock的skew是恒定的。问题表述为Skew acc[k] = S[k] * num[k] + e[k]，在步骤k处，Skew acc[k]是前num[k]帧实例的时钟偏差累积，S[k]是回归参数，num[k]表示帧实例的数量，e[k]是识别误差，识别误差e表示残差，即拟合值与实际值之间的差值。线性模型的斜率可以表示为发射器的clock skew。递归最小二乘法算法用于拟合数据并解决问题。

**E 应用**

（1）发送者识别

（2）ECU枚举

（3）入侵检测：通过监测两个因素来检测入侵，分别是与线性模型的累积偏差和异常值的丢弃率。首先收集一组测量值。预处理阶段，计算丢弃率，若丢弃率显著增加到大于阈值报告异常。模型生成阶段，若观察到与线性模型的任何异常偏差也触发警报。采用基于辨识误差的累积和CUSUM方法检测与线性模型的偏差，CUSUM方法通过累加从目标手段观测到的偏差来检测数据序列的变化点，随着时间推移可以检测到微小的偏差，基于辨识误差的CUSUM是将RLS的观测辨识误差e的累积偏差导出到平均辨识误差。偏差的累计总和超过上限或下限可以检测到入侵。上下限的更新过程如下![image-20241113151500605](https://s2.loli.net/2024/11/13/onBgmhp9VbO5sGf.png)

## 六、评价

**A 实验环境**

（1）数据采集器：PicoScope 5244D。

（2）原型：构建四节点CAN总线。

（3）实车：两辆量产车。雪佛兰科鲁兹和别克安可。

**B 对发送方识别和ECU枚举的评估**

（1）原型：设置原型上每个ECU发送四个不同的帧。结果如下图所示。（a）显示所有帧的累积时钟偏差，明显四个ECU被清楚识别出来。ECU0发送的四个帧的前100个帧实例结果绘制在（b）中。结果表明方法可以识别多个帧是否来自同一个ECU，以及区分来自不同ECU的帧。

![image-20241113144921070](https://s2.loli.net/2024/11/13/D8vqdmnSbA4XyEQ.png)

（2）雪佛兰科鲁兹：下图展示了雪佛兰科鲁兹的结果，强调了数据预处理的重要性。作图可以看出基于原始数据计算的时钟偏差积累几乎不能反映发送器时钟偏差的特征。经过数据预处理的结果可以很容易发现有四个ECU。

![image-20241113145313687](https://s2.loli.net/2024/11/13/wzqfW7UdsCBKySO.png)

（3）别克安可：分析与雪佛兰类似。

![image-20241113145542074](https://s2.loli.net/2024/11/13/fw8e1REuZ4NB3OD.png)

**C 入侵检测评估**

![image-20241113150011446](https://s2.loli.net/2024/11/13/FNCmT5ubvGy2wrg.png)

（1）原型：设置ECU0为受害者，ECU3为攻击者。训练数据长度设置为2000帧实例。检测结果如图（a）所示。红点表示安装伪装攻击。第二张图表示新接收数据块的丢弃率。原型无法检测到任何异常值。右图展示了CUSUM方法结果，攻击发生后累积偏差之和超过了控制下限。结果表明方法可以低于对原型的伪装攻击。

（2）真实车辆：ECU1和ECU0视为雪佛兰科鲁兹的受害者和攻击ECU，ECU A和ECU D是别克安可的受害者和攻击者。对雪佛兰来说可以通过丢弃率有效检测入侵。对别克来说攻击后虽然丢弃率没有超过阈值，但基于识别错误的CUSUM可以生效。

    综上该文章方法可以有效检测伪装攻击，且可以应用于周期性和非周期性流量。

## 七、结论

    为保护CAN的内在漏洞，本文提出了一种基于模型的方法，利用时钟偏移来识别发送ECU并检测攻击，与其他基于监督学习算法的方法比，我们的决策过程更清晰易懂。我们的方法基于帧级信号的测量，可以应用与周期性帧以及非周期性帧或零星帧。实验结果表明线性模型可以很好地接收到CAN帧的发送器，并区分专有CAN上的ECU。

# A comprehensive intrusion detection method for the internet of vehicles  based on federated learning architecture

[原文PDF](./A comprehensive intrusion detection method for the internet of vehicles  based on federated learning architecture.pdf)

    本文提出了FED-IoV，这是一种利用联邦学习架构为车联网定制的入侵检测方法。其旨在跨分布式边缘设备协作执行检测任务。将车辆通信交通数据转换为图像，并采用定制的模型MobileNet-Tiny进行特征提取，使 FED-IoV 能够实现高检测精度，同时可部署在资源有限的设备上。通过对数据集 CAN-Intrusion 和 CICIDS2017 的评估，FED-IoV 在联邦学习环境中分别展示了 98.51% 和 97.74% 的准确率，并且还展示了对不平衡数据集的出色检测能力。此外，在计算能力有限的设备（例如 Raspberry Pi 4 8GB）上，每个样本的预测延迟保持在 10 毫秒以下，与现有方法相比，准确性和实时性能明显更高。

**关键词：**车联网；入侵检测；联邦学习；深度学习

## 一、引言

    联邦学习概念最初由 Google 于 2016 年提出（McMahan et al.，（McMahan et al.， 2017）），旨在通过聚合来自不同客户端的模型参数更新而不共享客户端的原始数据来构建一个全局模型。其核心思想是利用隐私保护机制，例如差分隐私或安全的多方计算，安全地聚合来自去中心化数据源的模型更新，从而生成性能优越且不需要暴露敏感数据的统一模型。

    本文主要贡献：

（1）引入一种创新预处理技术，将通信数据转换为图像。设计了一个经优化和修剪得MobileNet-Tiny模型，实现了高精度和实时检测。

（2）提出一种采用联邦学习得入侵检测框架FED-IoV，允许多个独立且相同的深度训练模型构建一个全面的检测模型，该框架使每个客户端都能独立处理数据，有效降低数据泄露的风险。

## 二、背景和相关工作

    展示了一些有关车联网入侵检测和联邦学习最新的研究进展。

## 三、提出的方法

**3.1 整体架构**

![image-20241130131548584](https://s2.loli.net/2024/11/30/YEQkf52naDxAcom.png)

    信任权限为客户端和云服务器之间的通信提供公钥和私钥；云服务器通过与客户端交换模型参数并聚合所有客户端参数构建全局入侵检测模型；每个客户端代表一个本地入侵检测模型，主要职责包括本地数据收集、数据预处理和本地模型训练，完成训练后客户端与加密的服务器交互以更新模型参数。

    本研究探讨两种主要类型攻击，分别是针对数据盗窃和损害模型隐私和机密性的攻击。

    场景1：客户端训练之后，本地参数被上传到中央服务器。此时，中心服务器作为潜在的攻击者，可以利用收集到的本地参数发起重建攻击，恢复终端的原始数据，或者进行属性推理攻击，判断数据是否包含敏感属性。

    场景 2：在聚合终端参数时，中央服务器将全局参数重新分配给每个终端。此时，不受信任的终端可能会发起攻击，使用全局中间参数来重构某个类别的样本，推断特定记录中是否存在敏感属性，并从数据的共同特征中推断出拥有该记录的个人的条件。

**3.2 数据预处理**

**A 数据说明：**CAN数据帧各段说明

**B 数据转换：**最初将4个特征数据拆分转换为9个特征，结果如下图所示。

![image-20241130150238537](https://s2.loli.net/2024/11/30/2kQtJBp1AMIbyvF.png)

![image-20241130150252916](https://s2.loli.net/2024/11/30/LfqQnJEogWzI2SC.png)

    数据集包含9个重要特征，将连续的27个样本的9个特征转化为9x9x3的图像，每个图像都是三通道的方形彩色图像，图像基于时间戳生成，故可保留原始网络数据的时间序列相关性。由于交通数据维数较小，双三次插值用于将图像由9x9x3升级到224x224x3格式，旨在降低模型过拟合风险。

![image-20241130150948832](https://s2.loli.net/2024/11/30/IlwLa3phG7D8z4J.png)

![image-20241130150958143](https://s2.loli.net/2024/11/30/QhpzLMdnPGX1CRS.png)

    在上述数据处理步骤之后，生成的图像集作为检测模型的输入。图中可以清楚辨别出正常和各种攻击样本之间的区别。

![image-20241130151043290](https://s2.loli.net/2024/11/30/4jSigOlZGQo28ER.png)

**3.3 MobileNet - Tiny**

    MobileNet V1 模型的特点是其组装深度可分离模块；在此基础上，MobileNet V2 模型引入了倒置残差和线性瓶颈层模块，形成了瓶颈残差模块。MobileNet V3 模型集成了 MobileNet V1 的深度可分离卷积模块和 MobileNet V2 的瓶颈残差模块，同时增加了SE注意力模块和新颖的激活函数H-swish(x)。

    为减少过拟合风险，删除了原始的MobileNet V3模型，通过删除三个特定的瓶颈层，保留了原始模型中的13层。本研究中MobileNet V-small 已被调整为基础架构，以适应车辆网络交通图像数据集的独特属性。

![image-20241130152254146](https://s2.loli.net/2024/11/30/NmGLtseKbfIkUCr.png)

**3.4 Fed-Job**

    FED-IoV工作流程分为五个阶段：

（1）系统初始化：权威机构生成密钥对，私钥Sk分发给每个客户端，此外机构为每对客户端和服务器分配对称密钥Si。

（2）本地模型训练：每个客户独立训练一个深度学习模型，利用前面描述的数据转换方法，将车辆交通数据转换为彩色图像，使用MobileNet-Tiny模型训练图像数据集。

（3）参数加密：本地模型训练完成后，客户端对模型参数进行加密再发送到服务器。

（4）参数聚合：服务端收到每个客户端的模型参数时，根据以下公式聚合计算模型参数。

![image-20241130153007348](https://s2.loli.net/2024/11/30/rg6oqfhsPCka7VZ.png)

![image-20241130153013922](https://s2.loli.net/2024/11/30/uBx9It2vEAwJTS5.png)

（5）参数更新：从客户端聚合加密的模型参数后，服务器将更新的参数发送回客户端。

## 四、实验和分析

**4.1 实验环境**

**4.2 数据集**

Car-Hacking和CICIDS2017

**4.3 评估指标**

    数据集分为0.8的训练集和0.2的测试集。评估指标有总体平均准确率(Acc)、精度(Pre)和召回率(Rec)。研究还记录了服务器级机器上的训练时间Training Time、车载级机器上的测试时间Testing Time和模型参数的数量Params。训练时间反映方法的收敛速度，测试时间展示了方法的实时检测能力，参数数量表示方法使用的深度学习模型大小。

**4.4 实验结果**

**A 模型改进消融的实验结果**

![image-20241130154615985](https://s2.loli.net/2024/11/30/L8yvMX93YTjGPVB.png)

    当原始MobileNet V3的三个瓶颈层被移除时，检测精度最大化。用CA注意力机制替换SE注意力机制形成的MobileNet-Tiny在上述两个数据集上的关键性指标上都表现出显著改进。

![image-20241130154732040](https://s2.loli.net/2024/11/30/1Fpz8w5Iqs2SjPH.png)

**B 各种局部模型的实验结果**

![image-20241130155211141](https://s2.loli.net/2024/11/30/g4O3wBzbpy9SUcJ.png)

![image-20241130155227168](https://s2.loli.net/2024/11/30/zBkc9SOUR78QMCl.png)

**C 各种联邦学习框架的实验结果**

![image-20241130155440217](https://s2.loli.net/2024/11/30/4zgqcZu7EolQUyY.png)

![image-20241130155450766](https://s2.loli.net/2024/11/30/T3gb5UvruoD4Yy9.png)

**D 复杂场景下检测性能的实验结果**

![image-20241130155918499](https://s2.loli.net/2024/11/30/b85Mog4iTN2H3Rw.png)

![image-20241130155928493](https://s2.loli.net/2024/11/30/tj1WxX27e5GFKua.png)

**E 现有文献中的实验结果**

    MTH-IDS 方法实现了 99.99% 和 99.88% 的检测准确率。然而，这种方法忽略了板载设备的低性能特性。理论上具有强大的检测能力，但难以在实际车联网环境中部署，无法解决用户数据隐私保护问题。同样，GRU 系统和 CANintelliIDS 方法采用了各种特征提取技术，并部署了多个深度学习模型进行检测，实现了值得称道的检测精度。然而，这些研究中的讨论狭隘地集中在提高检测准确性上，而没有探索实际场景中的实际部署实验和隐私保护方案。LightGBM+HBGB 方法的检测准确率为 96.97%，研究中报告称，即使部署在低性能设备上，它也能保持低于 10 毫秒的实时检测能力。然而，这种方法使用集中式训练方法，显然无法满足用户数据隐私保护的要求，其准确性仍有待提高。

![image-20241130160134515](https://s2.loli.net/2024/11/30/9h3sHK8TJ7FPZEr.png)

## 五、总结

    本文提出了一种FED-IoV的入侵检测方法，根据CAN数据特点，使用数据转换技术将CAN数据按时间顺序转换为三通道彩色图像。考虑到车载设备的低性能，设计了一个轻量级模型MobileNet-Tiny训练和学习图像数据集。之后实现了一个基于联邦学习架构的车联网入侵检测框架，允许客户端在本地训练数据，客户端与服务器之间参数传输采用严格的加密。

    在模型参数聚合过程中，假设所有客户端都是诚实的，只使用真实数据训练，服务器没有恶意修改参数。故FED-IoV框架目前条件严格，无法有效防御数据中毒攻击。
